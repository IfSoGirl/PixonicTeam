/*
 * File: app/controller/MainController.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('PixonicTeam.controller.MainController', {
    extend: 'Ext.app.Controller',

    requires: [
        'PixonicTeam.view.SlidingMenu',
        'PixonicTeam.view.ProfilePanel',
        'PixonicTeam.view.CalendarPanel'
    ],

    config: {
        control: {
            "[action=menuButtonPressed]": {
                tap: 'onMenuButtonTap'
            },
            "[action=menuItemPressed]": {
                tap: 'onMenuItemPressed'
            },
            "listitem": {
                onListItemTap: 'OnListItemTap'
            }
        }
    },

    onMenuButtonTap: function(button, e, eOpts) {
        var menus = Ext.Viewport.getMenus();
        if (Ext.Viewport.getMenus().left.isHidden()){
            Ext.Viewport.showMenu('left');
        }
        else {
            Ext.Viewport.hideMenu('left');
        }

    },

    onMenuItemPressed: function(button, e, eOpts) {
            var targetPanel;
            switch(button.id){
                case 'profileMenuItem': {
                    targetPanel = 'profilePanel';
                    break;
                }
                case 'calendarMenuItem': {
                    targetPanel = 'calendarPanel';
                    break;
                }
                case 'employeesMenuItem': {
                    targetPanel = 'employeePanel';
                    break;
                }
                default:
                    break;
            }
            this.showPanel(targetPanel);
    },

    OnListItemTap: function(listitem) {

    },

    launch: function() {
            mainController = this;
            Ext.Viewport.setMenu(Ext.create('PixonicTeam.view.SlidingMenu'), {
                side: 'left',
                reveal: false
            });

            Ext.Viewport.add(Ext.create('PixonicTeam.view.ProfilePanel'));
            Ext.Viewport.add(Ext.create('PixonicTeam.view.CalendarPanel'));

            var nav = Ext.create('PixonicTeam.view.EmployeesNav');
            Ext.Viewport.add(nav);
            Ext.create('PixonicTeam.view.ColleaguePanel', {
                title: 'Сотрудники'
            });

    },

    showPanel: function(panelName) {
            var tab, title;
            switch(panelName){
                case 'profilePanel': {
                    tab = Ext.getCmp('profilePanel');
                    break;
                }
                case 'calendarPanel': {
                    tab = Ext.getCmp('calendarPanel');
                    break;
                }
                case 'employeePanel': {
                    tab = Ext.getCmp('employeeNav');
                    break;
                }

                case 'colleaguePanel': {
                    tab = Ext.getCmp('colleaguePanel');
                    break;
                }
                case 'loginPanel': {
                    tab = Ext.getCmp('loginPanel');
                    loginController.showLoginElements();
                    break;
                }
                default:
                    break;
            }

            Ext.Viewport.hideMenu('left');
            Ext.Viewport.setActiveItem(tab);
    },

    parsePhoneForCall: function(phone) {
            var regExp = /\d+/g, phoneDigits = "+7";
            while ((m = regExp.exec(phone)) !== null) {
                phoneDigits += m[0];
            }
            return phoneDigits;
    },

    openUrl: function(url, separateWindow) {
            console.log("Controller open url!" + url);
            if (separateWindow)
                window.open(url, '_system','location=yes,closebuttoncaption=Done');
            else
            location.href = url;

    }

});