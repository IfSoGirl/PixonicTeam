{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userAlias": "loginController",
        "designer|userClassName": "LoginController"
    },
    "name": "MyController",
    "designerId": "1ac66694-44e0-4510-ac74-a68180d744ca",
    "cn": [
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "loginBtn",
                "selector": "#loginBtn"
            },
            "name": "loginBtn",
            "designerId": "8f5d01bd-d454-4c02-b65a-666c60f32dfc"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "[action=confirm]",
                "designer|targetType": "Ext.Button",
                "fn": "onButtonTap",
                "implHandler": [
                    "var params = 'client_id=' + encodeURIComponent(clientId);",
                    "params += '&redirect_uri='+encodeURIComponent(redirectUri);",
                    "params += '&response_type=code';",
                    "params += '&scope=' + encodeURIComponent(scopes);",
                    "var authUrl = 'https://accounts.google.com/o/oauth2/auth?' + params;",
                    "var win = window.open(authUrl, '_blank', 'location=no,toolbar=no,width=800, height=800');",
                    "gwin = win;",
                    " var context = this;",
                    "",
                    "win.addEventListener('loadstart', function (data) {",
                    "    console.log('LOAD START');",
                    "    console.log('Here is data url');",
                    "   console.log(data.url);",
                    "    var pos =  data.url.indexOf(redirectUri);",
                    "     console.log('redirect in data' + pos);",
                    "    if (pos === 0) {",
                    "        console.log('redirect url found, CLOSE WINDOW');",
                    "        win.close();",
                    "        var url = data.url;",
                    "        console.log('Final URL ' + url);",
                    "        access_code = /\\?code=(.+)$/.exec(url);",
                    "          var error = /\\?error=(.+)$/.exec(url);",
                    "        console.log('CODE = '+ access_code);",
                    "        console.log('ERROR = '+ error);",
                    "        //getToken();",
                    "",
                    "",
                    "        Ext.Ajax.request({",
                    "            url: 'https://www.googleapis.com/oauth2/v3/token',",
                    "            method: 'POST',",
                    "",
                    "            headers: { 'Content-Type': 'application/x-www-form-urlencoded'},",
                    "",
                    "            params: {",
                    "                client_id: clientId,",
                    "              //  client_secret: this.secret,",
                    "                redirect_uri: redirectUri,",
                    "                code: access_code,",
                    "                grant_type: 'authorization_code'",
                    "            },",
                    "",
                    "            callback: function(options, success, response) {",
                    "                console.log('Get server response'+response.responseText);",
                    "                console.log(esponse.responseText);",
                    "    }",
                    "});",
                    "",
                    "",
                    "    }",
                    "});",
                    " /*//else {",
                    "    console.log('InAppBrowser not found11');",
                    "    console.log(\"google window url \" + win.document.URL);",
                    "    var s = win.location.href;",
                    "    if (gwin.document.URL.indexOf(redirectUri) === 0) {",
                    "        console.log('redirect url found');",
                    "        win.close();",
                    "        var url = win.document.URL;",
                    "        console.log('Final URL ' + url);",
                    "        var access_code = context.gulp(url, 'code');",
                    "        if (access_code) {",
                    "        console.log('Access Code: ' + access_code);",
                    "    } else {",
                    "       console.log('Access Code Not Found');",
                    "        }",
                    "    }*/",
                    ""
                ],
                "name": "tap"
            },
            "name": "onButtonTap",
            "designerId": "a65220c2-bf42-477e-8476-7376c2c124d4"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "immediate"
                ],
                "fn": "checkAuth",
                "implHandler": [
                    "    console.log(\"trying login with immediate \" + immediate);",
                    "    gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: immediate}, this.handleAuthResult);"
                ]
            },
            "name": "checkAuth",
            "designerId": "e7f55c6f-85e2-4e46-9ecb-ff207dd09d65"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "result"
                ],
                "fn": "handleAuthResult",
                "implHandler": [
                    " if (result && !result.error) {",
                    "     console.log(\"Auth OK, token\" + result.access_token);",
                    "    var c =  this.getController('loginController');",
                    " } else {",
                    "     console.log(\"AUth ERROR\"+ result.error);",
                    " }",
                    ""
                ]
            },
            "name": "handleAuthResult",
            "designerId": "33e9fe4a-fd00-4900-b334-d4d9780091c1"
        },
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "launch",
                "implHandler": [
                    "        console.log('launch controller');",
                    "        gapi.client.setApiKey(apiKey);",
                    ""
                ]
            },
            "name": "launch",
            "designerId": "358bc240-5ab4-4443-9654-0939f55e5fa4"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loadCalendarApi",
                "implHandler": [
                    "gapi.client.load('calendar', 'v3', listUpcomingEvents);",
                    ""
                ]
            },
            "name": "loadCalendarApi",
            "designerId": "dbaacef5-72e5-491d-90f8-f0499be7ecbe"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "listUpcomingEvents"
            },
            "name": "listUpcomingEvents",
            "designerId": "4860c54e-017c-4210-a245-4b92b07f6662"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "loginView",
                "selector": "#loginpanel"
            },
            "name": "loginView",
            "designerId": "543354b3-f72b-4e2b-909b-c03eaab579c0"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "profileView",
                "selector": "#profileWindow"
            },
            "name": "profileView",
            "designerId": "47ab92bc-2425-497f-8865-4c6014ecc95c"
        }
    ]
}